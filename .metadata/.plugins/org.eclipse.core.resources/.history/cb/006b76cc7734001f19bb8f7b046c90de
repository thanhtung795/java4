package Controller;

import java.io.IOException;
import javax.accessibility.*;
import javax.script.*;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import CRUD.UserService;
import Model.User;

@WebServlet(urlPatterns = {"/api-admin-category"})
public class UserController extends HttpServlet {
    private static final long serialVersionUID = 7733176626714241908L;

    private UserService userService;

    @Override
    public void init() throws ServletException {
        userService = new UserService();  // Khởi tạo UserService tại đây
    }

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        List<User> users = userService.getAllUsers();
        // Chuyển đổi danh sách người dùng thành JSON và trả về cho client
        resp.setContentType("application/json");
        resp.setCharacterEncoding("UTF-8");
        resp.getWriter().write(new ObjectMapper().writeValueAsString(users));
    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        // Đọc dữ liệu từ yêu cầu
        BufferedReader reader = req.getReader();
        HttpUtil httpUtil = HttpUtil.of(reader);
        User newUser = httpUtil.toModel(User.class);

        // Thêm người dùng mới
        userService.addUser(newUser);

        // Trả về phản hồi thành công
        resp.setContentType("application/json");
        resp.setCharacterEncoding("UTF-8");
        resp.getWriter().write(new ObjectMapper().writeValueAsString(newUser));
    }

    // Thêm các phương thức doPut, doDelete nếu cần thiết
}
